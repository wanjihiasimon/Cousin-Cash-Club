<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Cousin Contribution Hub 🎉</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #fdf6e3; color: #333; }
    h1, h2 { text-align: center; color: #ff4081; }
    .container { max-width: 900px; margin: auto; padding: 20px; }
    .form { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; justify-content: center; }
    input, button { padding: 10px; border-radius: 8px; border: 1px solid #ddd; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ddd; padding: 10px; text-align: center; }
    th { background: #ffccbc; }
    button { background: #ff4081; color: white; border: none; cursor: pointer; }
    button:hover { background: #e91e63; }
    #stats { display: flex; justify-content: space-around; margin: 20px 0; font-size: 18px; font-weight: bold; }
    #countdown { text-align: center; font-size: 18px; margin: 15px; }
    #loginScreen { text-align: center; margin-top: 100px; }
    #loginScreen input { padding: 10px; border-radius: 8px; border: 1px solid #ccc; }
    #loginScreen button { margin-top: 10px; }
    #verse { margin-top: 20px; font-style: italic; font-size: 16px; }
  </style>
</head>
<body>
  <!-- Login Screen -->
  <div id="loginScreen">
    <h1>🔐 Cousin Contribution Hub</h1>
    <p id="verse">"How good and pleasant it is when cousins come together in unity, for there YAHWEH bestows His blessing." – Psalm 133:1 (adapted)</p>
    <input id="loginPass" type="password" placeholder="Enter password">
    <br>
    <button onclick="login()">Login</button>
  </div>

  <!-- Main App -->
  <div id="app" style="display:none;" class="container">
    <h1>🎉 Cousin Contribution Tracker 🎉</h1>

    <div id="countdown"></div>

    <div class="form">
      <input id="name" placeholder="Cousin Name">
      <input id="amount" type="number" placeholder="Contribution (Ksh)">
      <input id="note" placeholder="Note (optional)">
      <button onclick="addContribution()">Add</button>
    </div>

    <!-- Stats -->
    <div id="stats">
      <div>💰 Total <span id="total">Ksh 0</span></div>
      <div>👥 Contributors <span id="contributors">0</span></div>
      <div>📊 Average <span id="average">Ksh 0</span></div>
    </div>

    <table>
      <thead>
        <tr><th>Name</th><th>Contribution (Ksh)</th><th>Note</th><th>Action</th></tr>
      </thead>
      <tbody id="contribTable"></tbody>
    </table>

    <canvas id="barChart" height="120"></canvas>
  </div>

  <script>
    let contributions = JSON.parse(localStorage.getItem("cousins")) || [];
    let chart;

    // Login
    function login() {
      const pass = document.getElementById("loginPass").value;
      if (pass === "lifelong") {
        document.getElementById("loginScreen").style.display = "none";
        document.getElementById("app").style.display = "block";
        renderTable();
      } else {
        alert("❌ Wrong password!");
      }
    }

    // Save data
    function saveData() {
      localStorage.setItem("cousins", JSON.stringify(contributions));
    }

    // Update Stats
    function updateStats() {
      const total = contributions.reduce((sum, c) => sum + c.amount, 0);
      const count = contributions.length;
      const avg = count ? (total / count).toFixed(2) : 0;
      document.getElementById("total").textContent = "Ksh " + total;
      document.getElementById("contributors").textContent = count;
      document.getElementById("average").textContent = "Ksh " + avg;
    }

    // Render Table
    function renderTable() {
      const tbody = document.getElementById("contribTable");
      tbody.innerHTML = "";
      contributions.forEach((c, i) => {
        tbody.innerHTML += `<tr>
          <td>${c.name}</td>
          <td>Ksh ${c.amount}</td>
          <td>${c.note || ""}</td>
          <td>
            <button onclick="editEntry(${i})">✏️ Edit</button>
            <button onclick="deleteEntry(${i})">🗑️ Delete</button>
          </td>
        </tr>`;
      });
      updateStats();
      renderChart();
    }

    // Add Contribution (with password)
    function addContribution() {
      const pass = prompt("Enter password to add contribution:");
      if (pass !== "thewanjihias") return alert("❌ Wrong password!");

      const name = document.getElementById("name").value.trim();
      const amount = Number(document.getElementById("amount").value);
      const note = document.getElementById("note").value.trim();
      if (!name || !amount) return alert("Please enter valid name and amount!");

      contributions.push({ name, amount, note });
      saveData();
      renderTable();
      document.getElementById("name").value = "";
      document.getElementById("amount").value = "";
      document.getElementById("note").value = "";
    }

    // Edit Entry
    function editEntry(i) {
      const pass = prompt("Enter password to edit:");
      if (pass !== "thewanjihias") return alert("❌ Wrong password!");
      const newName = prompt("Edit name:", contributions[i].name);
      const newAmount = Number(prompt("Edit amount:", contributions[i].amount));
      const newNote = prompt("Edit note:", contributions[i].note);
      if (!newName || !newAmount) return;
      contributions[i] = { name: newName, amount: newAmount, note: newNote };
      saveData();
      renderTable();
    }

    // Delete Entry
    function deleteEntry(i) {
      const pass = prompt("Enter password to delete:");
      if (pass !== "thewanjihias") return alert("❌ Wrong password!");
      if (confirm("Are you sure?")) {
        contributions.splice(i, 1);
        saveData();
        renderTable();
      }
    }

    // Bar Chart
    function renderChart() {
      const ctx = document.getElementById("barChart").getContext("2d");
      if (chart) chart.destroy();
      chart = new Chart(ctx, {
        type: "bar",
        data: {
          labels: contributions.map(c => c.name),
          datasets: [{
            label: "Contributions (Ksh)",
            data: contributions.map(c => c.amount),
            backgroundColor: "#ff4081"
          }]
        },
        options: { responsive: true, plugins: { legend: { display: false } } }
      });
    }

    // Countdown Timer
    function countdown() {
      const today = new Date("September 10, 2025").getTime();
      const endDate = new Date("November 30, 2025").getTime();
      const now = new Date().getTime();
      const distance = endDate - now;
      const days = Math.floor(distance / (1000 * 60 * 60 * 24));
      document.getElementById("countdown").textContent =
        days >= 0 ? `⏳ Days left to contribute: ${days}` : "✅ Contributions closed!";
    }
    setInterval(countdown, 1000);
    countdown();

    renderTable();
  </script>
</body>
</html>
